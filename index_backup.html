<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSL2 Score Predictor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">‚öΩ WSL2 Predictor</div>
                <div class="user-info">
                    <span id="username-display">Welcome!</span>
                    <span class="user-score" id="user-total-score">0 pts</span>
                </div>
            </div>
        </div>
        <nav class="nav">
            <div class="container">
                <div class="nav-content">
                    <button class="nav-btn active" onclick="showScreen('predictions')">Predict</button>
                    <button class="nav-btn" onclick="showScreen('league')">League</button>
                    <button class="nav-btn" onclick="showScreen('scores')">My Scores</button>
                    <button class="nav-btn" onclick="showScreen('fixtures')">Fixtures</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Predictions Screen -->
            <div id="predictions-screen" class="screen active">
                <div class="card">
                    <h3>üéØ Make Your Predictions</h3>
                    <div id="current-gameweek-info">
                        <p><strong>Gameweek 1</strong> - Make your predictions before the deadline!</p>
                    </div>
                </div>
                
                <div id="predictions-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading fixtures...</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="savePredictions()" id="save-predictions-btn" disabled>
                        Save All Predictions
                    </button>
                </div>
            </div>

            <!-- League Screen -->
            <div id="league-screen" class="screen">
                <div class="card" id="league-info-card">
                    <h3>üèÜ League Table</h3>
                    <div id="league-info">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading league data...</p>
                        </div>
                    </div>
                </div>
                
                <div id="league-table-container">
                    <div class="card">
                        <div class="league-table">
                            <table id="league-table">
                                <thead>
                                    <tr>
                                        <th>Pos</th>
                                        <th>Player</th>
                                        <th>Points</th>
                                        <th>GW</th>
                                    </tr>
                                </thead>
                                <tbody id="league-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="showLeagueModal()">
                        Create/Join League
                    </button>
                </div>
            </div>

            <!-- My Scores Screen -->
            <div id="scores-screen" class="screen">
                <div class="card">
                    <h3>üìä My Performance</h3>
                    <div class="score-summary" id="score-summary">
                        <div class="score-item">
                            <span class="score-value" id="total-score-display">0</span>
                            <span class="score-label">Total Points</span>
                        </div>
                        <div class="score-item">
                            <span class="score-value" id="current-position">-</span>
                            <span class="score-label">League Position</span>
                        </div>
                        <div class="score-item">
                            <span class="score-value" id="gameweek-score">0</span>
                            <span class="score-label">Last Gameweek</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Weekly Breakdown</h3>
                    <div id="weekly-scores">
                        <div class="empty-state">
                            <p>No scores yet. Make some predictions!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fixtures Screen -->
            <div id="fixtures-screen" class="screen">
                <div class="card">
                    <h3>üìÖ Fixtures & Results</h3>
                    <div id="fixtures-container">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading fixtures...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="welcome-modal" class="modal">
        <div class="modal-content">
            <h3>Welcome to WSL2 Predictor!</h3>
            <div class="form-group">
                <label for="username-input">Choose your username:</label>
                <input type="text" id="username-input" placeholder="Enter your username" maxlength="20">
            </div>
            <div style="text-align: center;">
                <button class="btn" onclick="setUsername()">Get Started</button>
            </div>
        </div>
    </div>

    <div id="league-modal" class="modal">
        <div class="modal-content">
            <h3>League Management</h3>
            <div id="league-options">
                <div class="form-group">
                    <label for="join-league-input">Join existing league:</label>
                    <input type="text" id="join-league-input" placeholder="Enter 6-character league code" maxlength="6">
                </div>
                <div style="text-align: center; margin: 16px 0;">
                    <button class="btn" onclick="joinLeague()">Join League</button>
                </div>
                
                <hr style="margin: 20px 0;">
                
                <div class="form-group">
                    <label for="create-league-input">Create new league:</label>
                    <input type="text" id="create-league-input" placeholder="Enter league name" maxlength="30">
                </div>
                <div style="text-align: center; margin: 16px 0;">
                    <button class="btn" onclick="createLeague()">Create League</button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('league-modal')">Cancel</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">‚öΩ WSL2 Predictor</div>
                <div class="user-info">
                    <span id="username-display">Welcome!</span>
                    <span class="user-score" id="user-total-score">0 pts</span>
                </div>
            </div>
        </div>
        <nav class="nav">
            <div class="container">
                <div class="nav-content">
                    <button class="nav-btn active" onclick="showScreen('predictions')">Predict</button>
                    <button class="nav-btn" onclick="showScreen('league')">League</button>
                    <button class="nav-btn" onclick="showScreen('scores')">My Scores</button>
                    <button class="nav-btn" onclick="showScreen('fixtures')">Fixtures</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Predictions Screen -->
            <div id="predictions-screen" class="screen active">
                <div class="card">
                    <h3>üéØ Make Your Predictions</h3>
                    <div id="current-gameweek-info">
                        <p><strong>Gameweek 1</strong> - Make your predictions before the deadline!</p>
                    </div>
                </div>
                
                <div id="predictions-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading fixtures...</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="savePredictions()" id="save-predictions-btn" disabled>
                        Save All Predictions
                    </button>
                </div>
            </div>

            <!-- League Screen -->
            <div id="league-screen" class="screen">
                <div class="card" id="league-info-card">
                    <h3>üèÜ League Table</h3>
                    <div id="league-info">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading league data...</p>
                        </div>
                    </div>
                </div>
                
                <div id="league-table-container">
                    <div class="card">
                        <div class="league-table">
                            <table id="league-table">
                                <thead>
                                    <tr>
                                        <th>Pos</th>
                                        <th>Player</th>
                                        <th>Points</th>
                                        <th>GW</th>
                                    </tr>
                                </thead>
                                <tbody id="league-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="showLeagueModal()">
                        Create/Join League
                    </button>
                </div>
            </div>

            <!-- My Scores Screen -->
            <div id="scores-screen" class="screen">
                <div class="card">
                    <h3>üìä My Performance</h3>
                    <div class="score-summary" id="score-summary">
                        <div class="score-item">
                            <span class="score-value" id="total-score-display">0</span>
                            <span class="score-label">Total Points</span>
                        </div>
                        <div class="score-item">
                            <span class="score-value" id="current-position">-</span>
                            <span class="score-label">League Position</span>
                        </div>
                        <div class="score-item">
                            <span class="score-value" id="gameweek-score">0</span>
                            <span class="score-label">Last Gameweek</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Weekly Breakdown</h3>
                    <div id="weekly-scores">
                        <div class="empty-state">
                            <p>No scores yet. Make some predictions!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fixtures Screen -->
            <div id="fixtures-screen" class="screen">
                <div class="card">
                    <h3>üìÖ Fixtures & Results</h3>
                    <div id="fixtures-container">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading fixtures...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="welcome-modal" class="modal">
        <div class="modal-content">
            <h3>Welcome to WSL2 Predictor!</h3>
            <div class="form-group">
                <label for="username-input">Choose your username:</label>
                <input type="text" id="username-input" placeholder="Enter your username" maxlength="20">
            </div>
            <div style="text-align: center;">
                <button class="btn" onclick="setUsername()">Get Started</button>
            </div>
        </div>
    </div>

    <div id="league-modal" class="modal">
        <div class="modal-content">
            <h3>League Management</h3>
            <div id="league-options">
                <div class="form-group">
                    <label for="join-league-input">Join existing league:</label>
                    <input type="text" id="join-league-input" placeholder="Enter 6-character league code" maxlength="6">
                </div>
                <div style="text-align: center; margin: 16px 0;">
                    <button class="btn" onclick="joinLeague()">Join League</button>
                </div>
                
                <hr style="margin: 20px 0;">
                
                <div class="form-group">
                    <label for="create-league-input">Create new league:</label>
                    <input type="text" id="create-league-input" placeholder="Enter league name" maxlength="30">
                </div>
                <div style="text-align: center; margin: 16px 0;">
                    <button class="btn" onclick="createLeague()">Create League</button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('league-modal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let currentUser = {
            username: '',
            leagueCode: '',
            predictions: {},
            totalScore: 0,
            gameweekScores: {}
        };

        let currentGameweek = 1;
        let fixturesData = [];
        let leagueData = null;

        // Sample fixtures data (in real app, this would be fetched from JSON files)
        const sampleFixtures = {
            season: "2024-25",
            gameweeks: [
                {
                    gameweek: 1,
                    matches: [
                        {
                            id: "gw1_match1",
                            homeTeam: "Arsenal Women",
                            awayTeam: "Liverpool Women",
                            kickoffTime: "2024-09-29T14:30:00Z",
                            homeScore: null,
                            awayScore: null,
                            status: "upcoming"
                        },
                        {
                            id: "gw1_match2",
                            homeTeam: "Chelsea Women",
                            awayTeam: "Manchester United Women",
                            kickoffTime: "2024-09-29T16:30:00Z",
                            homeScore: null,
                            awayScore: null,
                            status: "upcoming"
                        },
                        {
                            id: "gw1_match3",
                            homeTeam: "Manchester City Women",
                            awayTeam: "Brighton Women",
                            kickoffTime: "2024-09-30T14:00:00Z",
                            homeScore: null,
                            awayScore: null,
                            status: "upcoming"
                        }
                    ]
                }
            ]
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadUserData();
            if (!currentUser.username) {
                showModal('welcome-modal');
            } else {
                updateUserDisplay();
                loadFixturesData();
                loadLeagueData();
            }
        }

        // User Management
        function loadUserData() {
            const userData = localStorage.getItem('wsl2_user_data');
            if (userData) {
                currentUser = { ...currentUser, ...JSON.parse(userData) };
            }
        }

        function saveUserData() {
            localStorage.setItem('wsl2_user_data', JSON.stringify(currentUser));
        }

        function setUsername() {
            const username = document.getElementById('username-input').value.trim();
            if (username && username.length >= 2) {
                currentUser.username = username;
                saveUserData();
                updateUserDisplay();
                closeModal('welcome-modal');
                loadFixturesData();
                loadLeagueData();
                showToast('Welcome to WSL2 Predictor, ' + username + '!');
            } else {
                showToast('Please enter a valid username (at least 2 characters)', 'error');
            }
        }

        function updateUserDisplay() {
            document.getElementById('username-display').textContent = currentUser.username;
            document.getElementById('user-total-score').textContent = currentUser.totalScore + ' pts';
        }

        // Screen Navigation
        function showScreen(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenName + '-screen').classList.add('active');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load screen-specific data
            switch(screenName) {
                case 'predictions':
                    loadPredictionsScreen();
                    break;
                case 'league':
                    loadLeagueScreen();
                    break;
                case 'scores':
                    loadScoresScreen();
                    break;
                case 'fixtures':
                    loadFixturesScreen();
                    break;
            }
        }

        // Modal Management
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Toast Notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Data Loading Functions
        function loadFixturesData() {
            // In production, this would fetch from actual API/JSON files
            // For now, using sample data
            setTimeout(() => {
                fixturesData = sampleFixtures.gameweeks;
                loadPredictionsScreen();
                loadFixturesScreen();
            }, 500);
        }

        function loadLeagueData() {
            // In production, this would fetch league data from GitHub Pages
            if (currentUser.leagueCode) {
                setTimeout(() => {
                    // Sample league data
                    leagueData = {
                        leagueCode: currentUser.leagueCode,
                        leagueName: "Friends Prediction League",
                        participants: [
                            {
                                username: currentUser.username,
                                totalScore: currentUser.totalScore,
                                gameweekScores: currentUser.gameweekScores,
                                lastUpdated: new Date().toISOString()
                            },
                            {
                                username: "Alice",
                                totalScore: 45,
                                gameweekScores: {"1": 15, "2": 18, "3": 12},
                                lastUpdated: "2024-09-28T16:30:00Z"
                            },
                            {
                                username: "Bob",
                                totalScore: 38,
                                gameweekScores: {"1": 12, "2": 8, "3": 18},
                                lastUpdated: "2024-09-28T15:45:00Z"
                            }
                        ]
                    };
                    loadLeagueScreen();
                }, 700);
            }
        }

        // Screen Loading Functions
        function loadPredictionsScreen() {
            const container = document.getElementById('predictions-container');
            
            if (fixturesData.length === 0) {
                container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading fixtures...</p></div>';
                return;
            }
            
            const currentGameweekData = fixturesData.find(gw => gw.gameweek === currentGameweek);
            if (!currentGameweekData) {
                container.innerHTML = '<div class="empty-state"><p>No fixtures available for this gameweek.</p></div>';
                return;
            }
            
            let html = '';
            currentGameweekData.matches.forEach(match => {
                const isLocked = isMatchLocked(match.kickoffTime);
                const prediction = currentUser.predictions[`gameweek_${currentGameweek}`]?.find(p => p.matchId === match.id);
                
                html += `
                    <div class="match-card ${isLocked ? 'locked' : ''}">
                        <div class="match-info">
                            <div class="teams">${match.homeTeam} vs ${match.awayTeam}</div>
                            <div class="match-time">
                                ${formatMatchTime(match.kickoffTime)}
                                ${isLocked ? '<span class="deadline-warning">LOCKED</span>' : getTimeToDeadline(match.kickoffTime)}
                            </div>
                        </div>
                        <div class="prediction-inputs">
                            ${isLocked ? 
                                '<span class="locked-label">LOCKED</span>' : 
                                `<input type="number" class="score-input" id="home-${match.id}" 
                                    min="0" max="9" value="${prediction?.homeScore || ''}" 
                                    onchange="updatePrediction('${match.id}')">
                                <span class="vs">-</span>
                                <input type="number" class="score-input" id="away-${match.id}" 
                                    min="0" max="9" value="${prediction?.awayScore || ''}" 
                                    onchange="updatePrediction('${match.id}')">`
                            }
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateSaveButton();
        }

        function loadLeagueScreen() {
            const infoContainer = document.getElementById('league-info');
            const tableContainer = document.getElementById('league-table-body');
            
            if (!currentUser.leagueCode || !leagueData) {
                infoContainer.innerHTML = `
                    <div class="empty-state">
                        <p>You're not in a league yet!</p>
                        <p>Create a new league or join an existing one to compete with friends.</p>
                    </div>
                `;
                tableContainer.innerHTML = '';
                return;
            }
            
            // Show league info
            infoContainer.innerHTML = `
                <div class="league-code-display">
                    <div class="league-code">${leagueData.leagueCode}</div>
                    <div>Share this code with friends to join!</div>
                </div>
                <p><strong>${leagueData.leagueName}</strong></p>
                <p>${leagueData.participants.length} participants</p>
            `;
            
            // Sort participants by score
            const sortedParticipants = [...leagueData.participants].sort((a, b) => b.totalScore - a.totalScore);
            
            let tableHTML = '';
            sortedParticipants.forEach((participant, index) => {
                const isCurrentUser = participant.username === currentUser.username;
                const lastGWScore = Object.values(participant.gameweekScores).pop() || 0;
                
                tableHTML += `
                    <tr class="${isCurrentUser ? 'user-row' : ''}">
                        <td class="position">${index + 1}</td>
                        <td>${participant.username}${isCurrentUser ? ' (You)' : ''}</td>
                        <td><strong>${participant.totalScore}</strong></td>
                        <td>${lastGWScore}</td>
                    </tr>
                `;
            });
            
            tableContainer.innerHTML = tableHTML;
        }

        function loadScoresScreen() {
            document.getElementById('total-score-display').textContent = currentUser.totalScore;
            document.getElementById('gameweek-score').textContent = 
                Object.values(currentUser.gameweekScores).pop() || 0;
            
            // Update position if in league
            if (leagueData) {
                const sortedParticipants = [...leagueData.participants].sort((a, b) => b.totalScore - a.totalScore);
                const position = sortedParticipants.findIndex(p => p.username === currentUser.username) + 1;
                document.getElementById('current-position').textContent = position > 0 ? position : '-';
            } else {
                document.getElementById('current-position').textContent = '-';
            }
            
            // Show weekly breakdown
            const weeklyContainer = document.getElementById('weekly-scores');
            if (Object.keys(currentUser.gameweekScores).length === 0) {
                weeklyContainer.innerHTML = '<div class="empty-state"><p>No scores yet. Make some predictions!</p></div>';
                return;
            }
            
            let weeklyHTML = '';
            Object.entries(currentUser.gameweekScores).forEach(([gw, score]) => {
                weeklyHTML += `
                    <div class="match-card">
                        <div class="match-info">
                            <div class="teams">Gameweek ${gw}</div>
                            <div class="match-time">Points scored</div>
                        </div>
                        <div class="prediction-inputs">
                            <strong>${score} points</strong>
                        </div>
                    </div>
                `;
            });
            
            weeklyContainer.innerHTML = weeklyHTML;
        }

        function loadFixturesScreen() {
            const container = document.getElementById('fixtures-container');
            
            if (fixturesData.length === 0) {
                container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading fixtures...</p></div>';
                return;
            }
            
            let html = '';
            fixturesData.forEach(gameweek => {
                html += `<h4>Gameweek ${gameweek.gameweek}</h4>`;
                gameweek.matches.forEach(match => {
                    const resultDisplay = match.status === 'finished' ? 
                        `${match.homeScore} - ${match.awayScore}` : 
                        formatMatchTime(match.kickoffTime);
                    
                    html += `
                        <div class="match-card">
                            <div class="match-info">
                                <div class="teams">${match.homeTeam} vs ${match.awayTeam}</div>
                                <div class="match-time">${resultDisplay}</div>
                            </div>
                            ${match.status === 'finished' ? 
                                '<div class="prediction-inputs"><span class="locked-label">FINISHED</span></div>' :
                                '<div class="prediction-inputs"><span class="locked-label">UPCOMING</span></div>'
                            }
                        </div>
                    `;
                });
            });
            
            container.innerHTML = html;
        }

        // Prediction Functions
        function updatePrediction(matchId) {
            const homeScore = parseInt(document.getElementById(`home-${matchId}`).value);
            const awayScore = parseInt(document.getElementById(`away-${matchId}`).value);
            
            if (isNaN(homeScore) || isNaN(awayScore)) return;
            
            if (!currentUser.predictions[`gameweek_${currentGameweek}`]) {
                currentUser.predictions[`gameweek_${currentGameweek}`] = [];
            }
            
            const existingIndex = currentUser.predictions[`gameweek_${currentGameweek}`]
                .findIndex(p => p.matchId === matchId);
            
            const prediction = {
                matchId,
                homeScore,
                awayScore,
                timestamp: new Date().toISOString()
            };
            
            if (existingIndex >= 0) {
                currentUser.predictions[`gameweek_${currentGameweek}`][existingIndex] = prediction;
            } else {
                currentUser.predictions[`gameweek_${currentGameweek}`].push(prediction);
            }
            
            updateSaveButton();
        }

        function updateSaveButton() {
            const button = document.getElementById('save-predictions-btn');
            const gameweekPredictions = currentUser.predictions[`gameweek_${currentGameweek}`] || [];
            button.disabled = gameweekPredictions.length === 0;
        }

        function savePredictions() {
            saveUserData();
            showToast('Predictions saved successfully!');
            // In production, this would also sync with league data
        }

        // League Functions
        function showLeagueModal() {
            showModal('league-modal');
        }

        function createLeague() {
            const leagueName = document.getElementById('create-league-input').value.trim();
            if (!leagueName) {
                showToast('Please enter a league name', 'error');
                return;
            }
            
            // Generate random league code
            const leagueCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            currentUser.leagueCode = leagueCode;
            
            // In production, this would create the league on GitHub Pages
            leagueData = {
                leagueCode: leagueCode,
                leagueName: leagueName,
                participants: [{
                    username: currentUser.username,
                    totalScore: currentUser.totalScore,
                    gameweekScores: currentUser.gameweekScores,
                    lastUpdated: new Date().toISOString()
                }]
            };
            
            saveUserData();
            closeModal('league-modal');
            loadLeagueScreen();
            showToast(`League "${leagueName}" created! Code: ${leagueCode}`);
        }

        function joinLeague() {
            const leagueCode = document.getElementById('join-league-input').value.trim().toUpperCase();
            if (!leagueCode || leagueCode.length !== 6) {
                showToast('Please enter a valid 6-character league code', 'error');
                return;
            }
            
            // In production, this would fetch the league data from GitHub Pages
            currentUser.leagueCode = leagueCode;
            saveUserData();
            closeModal('league-modal');
            loadLeagueData();
            showToast(`Joined league with code: ${leagueCode}`);
        }

        // Utility Functions
        function isMatchLocked(kickoffTime) {
            const now = new Date();
            const kickoff = new Date(kickoffTime);
            const hourBeforeKickoff = new Date(kickoff.getTime() - (60 * 60 * 1000));
            return now > hourBeforeKickoff;
        }

        function formatMatchTime(kickoffTime) {
            const date = new Date(kickoffTime);
            return date.toLocaleDateString('en-GB', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getTimeToDeadline(kickoffTime) {
            const now = new Date();
            const kickoff = new Date(kickoffTime);
            const deadline = new Date(kickoff.getTime() - (60 * 60 * 1000));
            const timeLeft = deadline - now;
            
            if (timeLeft <= 0) return '<span class="deadline-warning">DEADLINE PASSED</span>';
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 0) {
                return `<span>Deadline in ${hours}h ${minutes}m</span>`;
            } else {
                return `<span class="deadline-warning">Deadline in ${minutes}m</span>`;
            }
        }

        // Auto-refresh functionality
        setInterval(() => {
            if (currentUser.username) {
                loadLeagueData();
                loadPredictionsScreen();
            }
        }, 30000); // Refresh every 30 seconds
    </script>
</body>
</html>